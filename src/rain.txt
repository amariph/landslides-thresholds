#!/bin/sh
# Shell Script to run python scripts for rainfall thresholds and forecast on Linux or MacOSX
# Add paths to python to path variable.
# *****************##########################*****************************
# Edit paths for system where the script will be running
# *****************##########################*****************************
PATH=~/anaconda/bin:$PATH  # Mac OS  PATH=? on Linux

cd ~/Desktop/LandslideThresholds # Folder location on MacOS
# On Linux, the LoggerNet user, lhp, stores the LandslideThresholds folder at /home/lhp/LandslideThresholds (~/LandslideThresholds)
# 
#rm ./rain_log.txt
date > ./rain_log.txt  #Edit path if this script is moved to a different folder
cd data/NWS
# rm *.xml

python "../../src/pyth_scripts/NWS.py" >> ../../rain_log.txt
cp *.png ../../plots/
cp ./data/ThCurrTabl.htm ../../plots/
# Copy plots to folder for web server
# cp *.png ~/xfer_to_web/
# cp ./data/ThCurrTabl.htm ~/xfer_to_web/ThCurrTabl.htm

# Make backup folder for year and copy annual data file to backup folder (Added 07/01/2016, RLB)
read day mon dat tim yr < date.txt
    if [ -d backup ]
    then :
    else
      mkdir backup
    fi
#
if [ "$dat" -eq "01" ] ; then
  if [ "$mon" = "Jul" ] ; then
    if [ -d backup/$yr ]
    then :
    else
      mkdir backup/$yr
    fi
    while read DataFile
    do
      grep -c [0-9] $DataFile > lines.txt
      read linct < lines.txt 
      if [ "$linct" -gt 500 ]
      then
        tail -n 480 $DataFile > temp1.txt
        mv $DataFile backup/$yr
        mv temp1.txt $DataFile
      fi
    done < sta2.txt
  fi
fi
#

cd "../Forecast"
python "../../src/pyth_scripts/Forecast.py"  >> ../../rain_log.txt
cp *.png ../../plots/
# Copy plots to folder for web server
# cp *.png ~/xfer_to_web/
# cp ./data/ThCurrTabl.htm ~/xfer_to_web/ThCurrTablF.htm

exit
